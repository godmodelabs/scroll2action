(function(a){var b=null,c=[],d={webkit:2,ie:3,opera:2,mozilla:2.5},e={findUp:function(b){var c=false,d=false;if(b===document){return false}a.each(f.elements,function(e,f){if(a(b).css("overflow-y")==="scroll"){d=true;return false}if(e===a(b).attr("data-s2a-id")){c=f;return false}});if(c){return c}if(d){return false}var g=b.parentElement||b.parentNode;if(g===null){return false}return e.findUp(g)},getBrowser:function(){var b=a.browser;return b.webkit?"webkit":b.msie?"ie":b.opera?"opera":b.mozilla?"mozilla":false},getSpeed:function(){return d[e.getBrowser()]||false}},f={f:{handlerIsSet:false,locked:false,scrollActive:false},config:{speed:e.getSpeed()||2},elements:{},elementCount:0,element:function(b){this.id=b.id;this.parent=b.parent;this.config={snapping:b.snapping||false};this.cache={position:b.parent.css("position")};this.content=a("<div class='s2a_content'></div>");this.wrapper=a("<div class='s2a_content_wrapper'></div>").append(a("> *",this.parent));this.scrollBar=a("<div class='s2a_scroll'></div>");this.scrollBarHandler=a("<div class='s2a_scroll_handler' ></div>");this.viewTop=a("<div class='s2a_view s2a_view_top'></div>");this.viewBottom=a("<div class='s2a_view s2a_view_bottom'></div>");this.parent.css("position","relative");this.parent.addClass("s2a_box");this.parent.attr("data-s2a-id",this.id);this.scrollBar.append(this.scrollBarHandler).appendTo(this.parent);this.content.append(this.wrapper).appendTo(this.parent);this.viewTop.prependTo(this.parent);this.viewBottom.appendTo(this.parent);this.setSize=function(){this.height=this.parent.innerHeight();this.contentHeight=this.content.innerHeight();this.targetHeight=this.contentHeight<this.height?this.height:this.contentHeight;this.scrollBarHandlerHeight=~~(this.height/this.contentHeight*this.height);this.ratio=this.height/this.targetHeight;var a=this.parent.height();var b=this.parent.width();this.content.height(a);this.viewBottom.width(b);this.viewTop.width(b);this.scrollBar.height(this.height);this.scrollBarHandler.height(this.scrollBarHandlerHeight)};this.setSize();f.handler.scrollbar(this)},init:function(b,c){if(b.hasClass("s2a_box")){return false}if(!f.f.handlerIsSet){if(window.addEventListener){window.addEventListener("DOMMouseScroll",f.handler.DOMMouseScroll,false)}window.onmousewheel=document.onmousewheel=f.handler.DOMMouseScroll;f.f.handlerIsSet=true}var d="s2a_"+ ++f.elementCount;f.elements[d]=new f.element(a.extend({},{id:d,parent:b},c))},remove:function(b){var c=b.attr("data-s2a-id");if(!c||!(c in f.elements)){return false}var d=f.elements[c];var e=a(".s2a_box",d.parent);e.removeScroll2Action();d.parent.removeClass("s2a_box");d.parent.html(d.wrapper.html());d.parent.removeAttr("data-s2a-id");d.parent.css("position",d.cache.position);delete f.elements[c]},handler:{DOMMouseScroll:function(b){if(!b){b=window.event}var c=e.findUp(a.event.fix(b).target);if(!!c){if(b.preventDefault){b.preventDefault()}var d=b.wheelDelta?b.wheelDelta:b.detail?-b.detail:0;f.scroll(c,d);b.returnValue=false}},scrollbar:function(){var b=null;var c=null;var d=0;return function(g){sb=g.scrollBarHandler;sb.mousedown(function(a){c=e.findUp(this);b=a.pageY;f.f.scrollActive=true;if(c!==null){c.parent.addClass("s2a_scrollActive");d=~~c.content.attr("data-s2a-pos")}});a("body").mouseup(function(){f.f.scrollActive=false;if(c!==null){c.parent.removeClass("s2a_scrollActive");c.scrollBar.removeClass("hover")}});a("body").mousemove(function(a){if(!f.f.scrollActive){return}if(c!==null){f.scrollTo(c,(d+a.pageY-b)/c.ratio)}})}}()},scroll:function(d,e){if(f.f.locked){return}e=e>0;var g=d.content.scrollTop()+f.config.speed*-1*(e?10:-10),h=d.content.hasClass("s2a_top")?1:d.content.hasClass("s2a_bottom")?-1:0;if(h>0&&e||h<0&&!e){return}if(h>0&&!e){d.content.removeClass("s2a_top");d.viewTop.removeClass("s2a_top");d.scrollBarHandler.height(d.scrollBarHandlerHeight);f.f.locked=true;window.setTimeout(function(){f.f.locked=false},400);return}if(h<0&&e){d.content.removeClass("s2a_bottom");d.viewBottom.removeClass("s2a_bottom");d.scrollBarHandler.height(d.scrollBarHandlerHeight);f.f.locked=true;window.setTimeout(function(){f.f.locked=false},400);return}f.scrollTo(d,g);if(g<0){d.content.addClass("s2a_top");d.viewTop.addClass("s2a_top");d.scrollBarHandler.height(d.scrollBarHandlerHeight/2);if(!d.config.snapping){window.clearTimeout(b);b=window.setTimeout(function(){window.clearTimeout(b);b=null;d.content.removeClass("s2a_top");d.viewTop.removeClass("s2a_top");d.scrollBarHandler.height(d.scrollBarHandlerHeight);d.scrollBar.removeClass("s2a_top")},150)}}else if(g>d.targetHeight-d.height){d.content.addClass("s2a_bottom");d.viewBottom.addClass("s2a_bottom");d.scrollBarHandler.css("top","auto");d.scrollBarHandler.css("bottom",0);d.scrollBarHandler.height(d.scrollBarHandlerHeight/2);a.each(c,function(a,b){window.clearInterval(b)});c=[];c.push(window.setInterval(function(){d.content.scrollTop(d.height+d.targetHeight)},10));window.setTimeout(function(){a.each(c,function(a,b){window.clearInterval(b)});c=[]},800);if(!d.config.snapping){b=window.setTimeout(function(){window.clearTimeout(b);b=null;d.content.removeClass("s2a_bottom");d.viewBottom.removeClass("s2a_bottom");d.scrollBarHandler.height(d.scrollBarHandlerHeight)},150)}}},scrollTo:function(a,b){a.content.scrollTop(b);a.content.attr("data-s2a-pos",b*a.ratio);var c=~~(b*a.ratio);a.scrollBarHandler.css("top",c+a.scrollBarHandlerHeight>a.height?a.height-a.scrollBarHandlerHeight-2:c<0?0:c)}};a.fn.scroll2Action=function(b){return this.each(function(){f.init(a(this),b)})};a.fn.removeScroll2Action=function(){return this.each(function(){f.remove(a(this))})}})(jQuery)